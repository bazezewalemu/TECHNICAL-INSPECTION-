<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‹¨á‰´áŠ­áŠ’áŠ­ áˆáˆ­áˆ˜áˆ« á‰‹á‰µ v45.0 - Ethiopian Complete Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #004d40; --accent: #c62828; --blue: #1976d2; --light: #f4f7f6; --dark: #263238; --excel: #1d6f42; --cloud: #6a1b9a; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--light); margin: 0; padding: 5px; font-size: 11px; color: var(--dark); }
        
        /* Auth Styles */
        .auth-container { max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); border-top: 6px solid var(--primary); }
        .auth-form input, .auth-form select { width: 100%; margin-bottom: 12px; padding: 12px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; }
        .auth-toggle { text-align: center; margin-top: 15px; cursor: pointer; color: var(--blue); font-weight: bold; text-decoration: underline; }

        /* App Interface */
        .container { max-width: 100%; display: none; }
        .header-box { background: white; padding: 10px 20px; border-radius: 10px; border-bottom: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 8px; }
        .section-card { background: white; padding: 12px; border-radius: 10px; border: 1px solid #e0e0e0; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        /* Form Layout */
        .form-grid { display: flex; flex-wrap: wrap; gap: 8px; align-items: flex-end; }
        .form-group { display: flex; flex-direction: column; gap: 2px; }
        .form-group label { font-weight: bold; font-size: 10px; color: var(--primary); text-transform: uppercase; }
        
        input, select, button { padding: 6px; border: 1px solid #ccc; border-radius: 5px; outline: none; font-size: 11px; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--blue); box-shadow: 0 0 5px rgba(25,118,210,0.2); }
        
        /* Buttons */
        .btn { cursor: pointer; border: none; font-weight: bold; color: white; display: inline-flex; align-items: center; justify-content: center; height: 32px; border-radius: 5px; padding: 0 12px; gap: 6px; }
        .btn-save { background: var(--primary); }
        .btn-blue { background: var(--blue); }
        .btn-red { background: var(--accent); }
        .btn-cloud { background: var(--cloud); }
        .btn-excel { background: var(--excel); }
        .btn-gray { background: #607d8b; }
        .btn:hover { opacity: 0.85; transform: translateY(-1px); }

        /* Controls */
        .controls-row { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; background: #e3f2fd; padding: 10px; border-radius: 10px; border: 1px solid #bbdefb; margin-bottom: 8px; }
        .bulk-box { background: #fff9c4; padding: 8px; border-radius: 8px; border: 1px solid #fbc02d; display: flex; gap: 6px; align-items: flex-end; }

        /* Table Styles */
        .table-wrapper { overflow-x: auto; background: white; border-radius: 10px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 10px; }
        th, td { padding: 8px; border-bottom: 1px solid #f0f0f0; text-align: center; }
        th { background: #fafafa; color: var(--primary); font-weight: 800; border-bottom: 2px solid #eee; }
        tr:hover { background: #f9f9f9; }

        /* Summary */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-top: 10px; }
        .stat-card { background: var(--dark); color: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-card b { font-size: 16px; display: block; margin-top: 5px; }

        .admin-only { display: none; }
        @media print { .no-print { display: none !important; } .container { display: block !important; } }
    </style>
</head>
<body>

    <div id="authScreen">
        <div id="signInBox" class="auth-container">
            <h2 style="text-align:center; color:var(--primary); margin-bottom:20px;">á‹¨á‰´áŠ­áŠ’áŠ­ áˆáˆ­áˆ˜áˆ« - áˆ˜áŒá‰¢á‹«</h2>
            <div class="auth-form">
                <input type="email" id="loginEmail" placeholder="áŠ¢áˆœá‹­áˆ áŠ á‹µáˆ«áˆ»">
                <input type="password" id="loginPass" placeholder="á“áˆµá‹ˆáˆ­á‹µ">
                <button onclick="handleSignIn()" class="btn btn-save" style="width:100%; height:45px;">áŒá‰£</button>
            </div>
            <div class="auth-toggle" onclick="toggleAuth('signup')">áŠ á‹²áˆµ á‰°áŒ á‰ƒáˆš áŠáˆ…? á‰°áˆ˜á‹áŒˆá‰¥</div>
        </div>

        <div id="signUpBox" class="auth-container" style="display:none;">
            <h2 style="text-align:center; color:var(--blue); margin-bottom:20px;">áŠ á‹²áˆµ á‰°áŒ á‰ƒáˆš áˆ˜áˆ˜á‹áŒˆá‰¢á‹«</h2>
            <div class="auth-form">
                <input type="text" id="regName" placeholder="áˆ™áˆ‰ áˆµáˆ">
                <input type="tel" id="regPhone" placeholder="áˆµáˆáŠ­ á‰áŒ¥áˆ­">
                <input type="email" id="regEmail" placeholder="áŠ¢áˆœá‹­áˆ">
                <input type="number" id="regYear" placeholder="áˆá‹°á‰µ (á‹“.áˆ)">
                <select id="regGender"><option value="">áŒ¾á‰³</option><option>á‹ˆáŠ•á‹µ</option><option>áˆ´á‰µ</option></select>
                <input type="password" id="regPass" placeholder="áŒ áŠ•áŠ«áˆ« á“áˆµá‹ˆáˆ­á‹µ ááŒ áˆ­">
                <button onclick="handleSignUp()" class="btn btn-blue" style="width:100%; height:45px;">á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áˆ˜á‹áŒá‰¥</button>
            </div>
            <div class="auth-toggle" onclick="toggleAuth('signin')">á‰°áˆ˜á‹áŒá‰ áˆƒáˆ? áˆˆáˆ˜áŒá‰£á‰µ áŠ¥á‹šáˆ… á‰°áŒ«áŠ•</div>
        </div>
    </div>

    <div class="container" id="appContainer">
        <div class="header-box">
            <div class="no-print">ğŸ‘¤ <b id="displayUser"></b> <span id="syncStatus"></span></div>
            <h2 style="margin:0; color:var(--primary);">á‹¨á‹ˆáˆá‰ƒá‹­á‰µ áŒ áŒˆá‹´ áˆ°á‰²á‰µ áˆáˆ˜áˆ« á‹áŠ• á‹¨á‰´áŠ­áŠ’áŠ­ áˆáˆ­áˆ˜áˆ« á‰‹á‰µ</h2>
            <button onclick="logout()" class="btn btn-red no-print" style="height:25px; font-size:10px;">á‹°áˆ…áŠ•áŠá‰± á‰°áŒ á‰¥á‰† á‹áŒ£</button> 
        </div>

        <div class="section-card no-print">
            <div class="form-grid" id="mainForm">
                <input type="hidden" id="editIndex" value="-1">
                
                <div class="form-group"><label>á‹°áˆ¨áˆ°áŠ</label><input id="receipt" type="text" style="width:70px;"></div>
                
                <div class="form-group"><label>á‰°áˆ½áŠ¨áˆ­áŠ«áˆª áŠ á‹­áŠá‰µ</label>
                    <select id="vType" style="width:90px;">
                        <option>á‰£áŒƒáŒ…</option><option>áˆá‰°áˆ­</option><option>áŠ áŠáˆµá‰°áŠ›</option><option>áˆ˜áˆˆáˆµá‰°áŠ›</option><option>áŠ¨áá‰°áŠ›</option><option>áŒ­áŠá‰µ</option><option>áˆŒáˆ‹</option>
                    </select>
                </div>

                <div class="form-group"><label>áŠ®á‹µ</label>
                    <select id="code" style="width:120px;"> 
                        <optgroup label="áŠ á‹²áˆµ áŠ á‰ á‰£"><option>áŠ áŠ -1-</option><option>áŠ áŠ -2-</option><option>áŠ áŠ -3-</option><option>áŠ áŠ -4-</option><option>áŠ áŠ -5-</option></optgroup> 
                        <optgroup label="áŠ áˆ›áˆ«"><option>áŠ áˆ›-1-</option><option>áŠ áˆ›-2-</option><option>áŠ áˆ›-3-</option><option>áŠ áˆ›-4-</option><option>áŠ áˆ›-5-</option></optgroup> 
                        <optgroup label="áŠ¦áˆ®áˆšá‹«"><option>áŠ¦áˆ®-1-</option><option>áŠ¦áˆ®-2-</option><option>áŠ¦áˆ®-3-</option></optgroup>
                        <optgroup label="áˆŒáˆá‰½"><option>á‹°á‰¡á‰¥-</option><option>áˆ¶áˆ›áˆŒ-</option><option>áŠ á‹áˆ­-</option><option>á‰¤áŒ‰-</option><option>áŒ‹áˆ-</option><option>áˆáˆ¨-</option><option>á‹µáˆ¬-</option><option>áŒá‹´áˆ«áˆ</option><option>áˆá‹©</option><option>UN</option></optgroup>
                    </select>
                </div>

                <div class="form-group"><label>áˆ°áˆŒá‹³ á‰áŒ¥áˆ­</label><input id="plate" type="text" style="width:80px;"></div>

                <div class="form-group"><label>á‰€áŠ• (áŠ¢á‰µá‹®áŒµá‹« 1-13)</label>
                    <div style="display:flex; gap:2px;">
                        <input type="number" id="ethDay" placeholder="á‰€áŠ•" min="1" max="30" style="width:40px;">
                        <select id="ethMonth" style="width:80px;">
                            <option value="1">áˆ˜áˆµáŠ¨áˆ¨áˆ</option><option value="2">áŒ¥á‰…áˆá‰µ</option><option value="3">áˆ…á‹³áˆ­</option>
                            <option value="4">á‰³áˆ…áˆ³áˆµ</option><option value="5">áŒ¥áˆ­</option><option value="6">á‹¨áŠ«á‰²á‰µ</option>
                            <option value="7">áˆ˜áŒ‹á‰¢á‰µ</option><option value="8">áˆšá‹«á‹á‹«</option><option value="9">áŒáŠ•á‰¦á‰µ</option>
                            <option value="10">áˆ°áŠ”</option><option value="11">áˆáˆáˆŒ</option><option value="12">áŠáˆáˆ´</option>
                            <option value="13">áŒ³áŒ‰áˆœáŠ•</option>
                        </select>
                        <input type="number" id="ethYear" value="2018" style="width:55px;">
                    </div>
                </div>

                <div class="form-group"><label>á‰£áˆˆáˆ™á‹«</label><input id="inspector" type="text" style="width:100px;"></div>

                <div class="form-group"><label>áˆáˆ­áˆ˜áˆ« á‰¦á‰³</label>
                    <select id="location" style="width:110px;">
                        <option>á‹áŠ•</option><option>á‹ˆáˆá‰ƒá‹­á‰µ</option><option>áŒ áŒˆá‹´</option><option>áŠ á‹áˆ«</option><option>á‰¤á‰µ áˆáˆ</option><option>á‰ƒáá‰µá‹«</option><option>á‹³áŠ•áˆ»</option><option>áˆ°á‰²á‰µ</option><option>áˆ›á‹­áŠ«á‹µáˆ«</option><option>á‰†áˆ«áˆªá‰µ</option>
                    </select>
                </div>

                <div class="form-group"><label>á‹¨á‰´áŠ­áŠ’áŠ­ á‹áŒ¤á‰µ</label>
                    <select id="tech" style="width:110px;">
                        <option value="áŠ–áˆ­áˆ›áˆ">áŠ–áˆ­áˆ›áˆ ğŸ™</option>
                        <option value="á‰½áŒáˆ­ á‹«áˆˆá‰ á‰µ">á‰½áŒáˆ­ á‹«áˆˆá‰ á‰µ âš ï¸</option>
                    </select>
                </div>

                <div class="form-group"><label>á‹¨áŠ­áá‹« áˆáŠ”á‰³</label>
                    <select id="payStatus" style="width:90px;">
                        <option>á‹¨áŠ¨áˆáˆˆ âœ…</option><option>á‹«áˆáŠ¨áˆáˆˆ âŒ</option>
                    </select>
                </div>

                <div class="form-group"><label>á‰¥áˆ­</label><input id="amount" type="number" style="width:70px;"></div>
                
                <button onclick="document.getElementById('camFile').click()" class="btn btn-gray" title="áá‰¶ áŠ áŠ•áˆ³">ğŸ“·</button>
                <input type="file" id="camFile" accept="image/*" capture="environment" style="display:none" onchange="handleImage(this)">
                <img id="previewImg" style="width:32px; height:32px; display:none; border-radius:5px; object-fit:cover;">
                
                <button onclick="saveData()" class="btn btn-save" id="saveBtn">áˆ˜á‹áŒá‰¥</button>
                <button onclick="fullReset()" class="btn btn-red">áŠ áŒ½á‹³</button>
            </div>
        </div>

        <div class="controls-row no-print">
            <div class="form-group"><label>áŠ¨á‰€áŠ•</label><input type="text" id="startDate" placeholder="á‰€/á‹ˆ/á‹“" style="width:70px;" oninput="render()"></div>
            <div class="form-group"><label>áŠ¥áˆµáŠ¨ á‰€áŠ•</label><input type="text" id="endDate" placeholder="á‰€/á‹ˆ/á‹“" style="width:70px;" oninput="render()"></div>
            <div class="form-group"><label>áˆáˆáŒ (áˆ°áˆŒá‹³/á‹°áˆ¨áˆ°áŠ)</label><input type="text" id="fSearch" oninput="render()" placeholder="áŠ¥á‹šáˆ… á‹­áƒá‰..."></div>
            
            <div class="bulk-box admin-only">
                <div class="form-group"><label>áŠ¨ á‰°.á‰</label><input type="number" id="bulkFrom" style="width:45px;"></div>
                <div class="form-group"><label>áŠ¥áˆµáŠ¨ á‰°.á‰</label><input type="number" id="bulkTo" style="width:45px;"></div>
                <button onclick="bulkDelete()" class="btn btn-red" style="height:28px;">á‰ áŒ…áˆáˆ‹ áŠ áŒ¥á‹ ğŸ—‘ï¸</button>
            </div>

            <div style="margin-left:auto; display:flex; gap:5px;">
                <button onclick="syncToCloud()" class="btn btn-cloud admin-only">â˜ï¸ Cloud</button>
                <button onclick="loadFromCloud()" class="btn admin-only" style="background:#4a148c;">ğŸ“¥ Get</button>
                <button onclick="exportXl()" class="btn btn-excel admin-only">ğŸ“¤ Excel</button>
                <button onclick="document.getElementById('importFile').click()" class="btn admin-only" style="background:#2e7d32;">ğŸ“¥ Import</button>
                <input type="file" id="importFile" accept=".xlsx,.xls" onchange="handleImport(this)" style="display:none">
                <button onclick="window.print()" class="btn btn-gray admin-only">ğŸ–¨ Print</button>
                <button onclick="toggleBin()" class="btn btn-red admin-only">â™»ï¸ (<span id="binCount">0</span>)</button>
            </div>
        </div>

        <div id="recycleBin" style="display:none; padding:15px; background:white; border:2px solid var(--accent); border-radius:10px; margin-bottom:10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="margin:0; color:var(--accent);">áˆªáˆ³á‹­áŠ­áˆ á‰¢áŠ• (á‹¨áŒ á‰ áˆ˜áˆ¨áŒƒá‹á‰½)</h3>
                <button onclick="emptyBin()" class="btn btn-red">áˆáˆ‰áŠ•áˆ áˆˆá‹˜áˆ‹áˆˆáˆ áŠ áŒ¥á‹ âš ï¸</button>
            </div>
            <div id="binList" style="max-height:200px; overflow-y:auto;"></div>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>á‰°.á‰</th><th>áá‰¶</th><th>á‹°áˆ¨áˆ°áŠ</th><th>áŠ á‹­áŠá‰µ</th><th>áˆ°áˆŒá‹³</th><th>á‰€áŠ• (á‹“.áˆ)</th>
                        <th>á‰£áˆˆáˆ™á‹«</th><th>á‰¦á‰³</th><th>á‹áŒ¤á‰µ</th><th>áŠ­áá‹«</th><th>á‰¥áˆ­</th><th class="no-print">áŠ¥áˆ­áˆáŒƒ</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody"></tbody>
            </table>
        </div>

        <div class="summary-grid">
            <div class="stat-card">áŒ á‰…áˆ‹áˆ‹ á‰°áˆ½áŠ¨áˆ­áŠ«áˆª <b id="stTotal">0</b></div>
            <div class="stat-card" style="background:#1b5e20;">áŒ á‰…áˆ‹áˆ‹ áŒˆá‰¢ (á‰¥áˆ­) <b id="stIncome">0.00</b></div>
            <div class="stat-card" style="background:#e65100;">á‰½áŒáˆ­ á‹«áˆˆá‰£á‰¸á‹ <b id="stIssue">0</b></div>
            <div class="stat-card" style="background:#2e7d32;">á‰½áŒáˆ­ á‹¨áˆŒáˆˆá‰£á‰¸á‹ <b id="stNormal">0</b></div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxzdL2xhfYz7bwyVZ7Tx2lJKH23aFPlMKGLUFNlHPjzM99q6USYLcS6KeLJ8wp3c9vCEA/exec";
        let db = JSON.parse(localStorage.getItem('TECH_DB_V45') || '[]');
        let bin = JSON.parse(localStorage.getItem('TECH_BIN_V45') || '[]');
        let currentImg = "";

        // --- AUTH LOGIC ---
        function toggleAuth(mode) {
            document.getElementById('signInBox').style.display = mode==='signin'?'block':'none';
            document.getElementById('signUpBox').style.display = mode==='signup'?'block':'none';
        }
        function handleSignUp() {
            const u = { name: document.getElementById('regName').value, email: document.getElementById('regEmail').value, pass: document.getElementById('regPass').value };
            if(!u.email || !u.pass) return alert("áŠ¥á‰£áŠ­áˆ… áˆ˜áˆ¨áŒƒ áŠ áˆŸáˆ‹!");
            let users = JSON.parse(localStorage.getItem('TECH_USERS') || '[]');
            users.push(u); localStorage.setItem('TECH_USERS', JSON.stringify(users));
            alert("á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áˆ˜á‹áŒá‰ áˆƒáˆ!"); toggleAuth('signin');
        }
        function handleSignIn() {
            const e = document.getElementById('loginEmail').value, p = document.getElementById('loginPass').value;
            if(e === "admin@tech.com" && p === "1313") {
                loginSuccess("Admin", "admin");
            } else {
                let users = JSON.parse(localStorage.getItem('TECH_USERS') || '[]');
                const found = users.find(u => u.email === e && u.pass === p);
                if(found) loginSuccess(found.name, "user"); else alert("áˆµáˆ…á‰°á‰µ!");
            }
        }
        function loginSuccess(name, role) {
            sessionStorage.setItem('isLogged', 'true'); sessionStorage.setItem('role', role); sessionStorage.setItem('activeUser', name);
            initApp();
        }
        function logout() { sessionStorage.clear(); location.reload(); }

        // --- CORE APP ---
        function initApp() {
            if(sessionStorage.getItem('isLogged')) {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                document.getElementById('displayUser').innerText = sessionStorage.getItem('activeUser');
                if(sessionStorage.getItem('role') === 'admin') document.querySelectorAll('.admin-only').forEach(e => e.style.display = 'inline-flex');
                render();
            }
        }

        function handleImage(input) {
            const reader = new FileReader();
            reader.onload = e => { currentImg = e.target.result; document.getElementById('previewImg').src = currentImg; document.getElementById('previewImg').style.display = 'block'; };
            reader.readAsDataURL(input.files[0]);
        }

        function saveData() {
            const plate = document.getElementById('plate').value;
            if(!plate) return alert("áˆ°áˆŒá‹³ á‰áŒ¥áˆ­ á‹«áˆµáŒˆá‰¡!");
            
            // á‹¨áŠ¢á‰µá‹®áŒµá‹« á‰€áŠ• áŠ á‰€áŠ“á‰£áŒ…
            const d = document.getElementById('ethDay').value;
            const m = document.getElementById('ethMonth').value;
            const y = document.getElementById('ethYear').value;
            
            const data = {
                receipt: document.getElementById('receipt').value, vType: document.getElementById('vType').value,
                code: document.getElementById('code').value, plate: plate, date: `${d}/${m}/${y}`,
                inspector: document.getElementById('inspector').value, location: document.getElementById('location').value,
                tech: document.getElementById('tech').value, payStatus: document.getElementById('payStatus').value,
                amount: Number(document.getElementById('amount').value) || 0, photo: currentImg
            };
            
            const idx = parseInt(document.getElementById('editIndex').value);
            if(idx > -1) db[idx] = data; else db.unshift(data);
            save(); fullReset(); render();
        }

        function render() {
            const body = document.getElementById('dataTableBody'), search = document.getElementById('fSearch').value.toLowerCase();
            const start = document.getElementById('startDate').value, end = document.getElementById('endDate').value;
            body.innerHTML = ''; let t = 0, inc = 0, issue = 0, norm = 0;

            db.forEach((d, i) => {
                if((d.plate + d.receipt).toLowerCase().includes(search)) {
                    t++; inc += d.amount;
                    if(d.tech === "á‰½áŒáˆ­ á‹«áˆˆá‰ á‰µ") issue++; else norm++;
                    
                    body.innerHTML += `<tr>
                        <td>${t}</td>
                        <td>${d.photo ? `<img src="${d.photo}" width="20" style="border-radius:2px;">` : '-'}</td>
                        <td>${d.receipt}</td><td>${d.vType}</td><td><b>${d.code}${d.plate}</b></td>
                        <td>${d.date}</td><td>${d.inspector}</td><td>${d.location}</td>
                        <td style="color:${d.tech==='áŠ–áˆ­áˆ›áˆ'?'green':'red'}">${d.tech}</td>
                        <td>${d.payStatus}</td><td>${d.amount.toFixed(2)}</td>
                        <td class="no-print">
                            <button onclick="editItem(${i})" style="color:blue; border:none; background:none; cursor:pointer;">âœï¸</button>
                            <button onclick="moveToBin(${i})" style="color:red; border:none; background:none; cursor:pointer;">ğŸ—‘ï¸</button>
                        </td>
                    </tr>`;
                }
            });
            document.getElementById('stTotal').innerText = t;
            document.getElementById('stIncome').innerText = inc.toFixed(2);
            document.getElementById('stIssue').innerText = issue;
            document.getElementById('stNormal').innerText = norm;
            document.getElementById('binCount').innerText = bin.length;
        }

        // --- BULK ACTIONS & BIN ---
        function bulkDelete() {
            const startNum = parseInt(document.getElementById('bulkFrom').value);
            const endNum = parseInt(document.getElementById('bulkTo').value);
            if(!startNum || !endNum || startNum > endNum) return alert("á‰µáŠ­áŠ­áˆˆáŠ› á‰°.á‰ á‹«áˆµáŒˆá‰¡!");
            
            if(confirm(`áŠ¨á‰°.á‰ ${startNum} áŠ¥áˆµáŠ¨ ${endNum} á‹«áˆˆá‹áŠ• á‹³á‰³ áˆ‹áŒ¥á‹?`)) {
                // áˆ˜áˆ¨áŒƒá‹á‰¹áŠ• áŠ¨ db á‰†áˆ­áŒ¦ á‹ˆá‹° bin áˆ˜á‹áˆ°á‹µ
                const countToRemove = (endNum - startNum) + 1;
                const removed = db.splice(startNum - 1, countToRemove);
                bin = removed.concat(bin);
                save(); render(); alert("á‰ áŒ…áˆáˆ‹ áŒ áá‰·áˆ!");
            }
        }

        function fullReset() {
            document.getElementById('editIndex').value = "-1";
            document.getElementById('saveBtn').innerText = "áˆ˜á‹áŒá‰¥";
            document.querySelectorAll('#mainForm input').forEach(i => { if(i.id !== 'ethYear') i.value = ''; });
            currentImg = ""; document.getElementById('previewImg').style.display = 'none';
        }

        function editItem(i) {
            const d = db[i];
            document.getElementById('receipt').value = d.receipt;
            document.getElementById('plate').value = d.plate;
            document.getElementById('inspector').value = d.inspector;
            document.getElementById('amount').value = d.amount;
            const dateParts = d.date.split('/');
            document.getElementById('ethDay').value = dateParts[0];
            document.getElementById('ethMonth').value = dateParts[1];
            document.getElementById('ethYear').value = dateParts[2];
            document.getElementById('editIndex').value = i;
            document.getElementById('saveBtn').innerText = "áŠ á‹µáˆµ";
            window.scrollTo(0,0);
        }

        function moveToBin(i) {
            if(confirm("á‹ˆá‹° á‰¢áŠ• á‹­áŒá‰£?")) {
                bin.unshift(db[i]); db.splice(i,1); save(); render();
            }
        }
        function toggleBin() { const d = document.getElementById('recycleBin'); d.style.display = d.style.display==='none'?'block':'none'; updateBinList(); }
        function updateBinList() {
            document.getElementById('binList').innerHTML = bin.map((x, i) => `
                <div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee;">
                    <span>${x.code}${x.plate} (${x.date})</span>
                    <div>
                        <button onclick="restore(${i})" style="background:green; color:white; border:none; padding:3px 8px; border-radius:3px; cursor:pointer;">ğŸ”„ áˆ˜áˆáˆµ</button>
                        <button onclick="delForever(${i})" style="background:red; color:white; border:none; padding:3px 8px; border-radius:3px; cursor:pointer;">âŒ</button>
                    </div>
                </div>
            `).join('');
        }
        function restore(i) { db.push(bin[i]); bin.splice(i,1); save(); render(); updateBinList(); }
        function delForever(i) { if(confirm("áˆˆá‹˜áˆ‹áˆˆáˆ á‹­áŒ¥á‹?")) { bin.splice(i,1); save(); render(); updateBinList(); } }
        function emptyBin() { if(confirm("áˆáˆ‰áŠ•áˆ á‹³á‰³ áˆˆá‹˜áˆ‹áˆˆáˆ áˆ›áŒ¥á‹á‰µ á‰µáˆáˆáŒ‹áˆˆáˆ…?")) { bin = []; save(); render(); updateBinList(); } }

        // --- CLOUD & EXTERNAL ---
        function syncToCloud() {
            document.getElementById('syncStatus').innerText = "â³ á‰ áˆ›áˆ˜áˆ³áˆ°áˆ áˆ‹á‹­...";
            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(db) })
            .then(() => { alert("á‹°áˆ˜áŠ“ (Cloud) áˆ‹á‹­ á‰°á‰€áˆáŒ§áˆ!"); document.getElementById('syncStatus').innerText = "âœ… á‰°áˆ˜áˆ³áˆµáˆáˆ"; })
            .catch(() => alert("áˆµáˆ…á‰°á‰µ á‰°áŠ¨áˆµá‰·áˆ!"));
        }
        function loadFromCloud() {
            fetch(SCRIPT_URL).then(r => r.json()).then(data => { db = data; save(); render(); alert("á‹³á‰³ áŠ¨á‹°áˆ˜áŠ“ á‹ˆáˆ­á‹·áˆ!"); });
        }
        function exportXl() { const ws = XLSX.utils.json_to_sheet(db); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Data"); XLSX.writeFile(wb, "á‹¨á‰´áŠ­áŠ’áŠ­_áˆªá–áˆ­á‰µ.xlsx"); }
        function handleImport(input) {
            const r = new FileReader();
            r.onload = e => {
                const wb = XLSX.read(e.target.result, {type:'binary'});
                const d = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                db = d.concat(db); save(); render(); alert("á‹³á‰³ áŒˆá‰¥á‰·áˆ!");
            };
            r.readAsBinaryString(input.files[0]);
        }
        function save() { localStorage.setItem('TECH_DB_V45', JSON.stringify(db)); localStorage.setItem('TECH_BIN_V45', JSON.stringify(bin)); }

        window.onload = initApp;
    </script>
</body>
</html>
